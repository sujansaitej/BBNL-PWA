<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fo-Fi IPTV â€” Security Audit &amp; Hardening Report</title>
  <style>
    :root {
      --bg: #0f172a;
      --surface: #1e293b;
      --surface2: #334155;
      --border: #475569;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: #3b82f6;
      --green: #22c55e;
      --red: #ef4444;
      --orange: #f59e0b;
      --yellow: #eab308;
      --purple: #a78bfa;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.7;
      padding: 2rem;
    }

    .container { max-width: 960px; margin: 0 auto; }

    /* Header */
    .header {
      text-align: center;
      padding: 3rem 2rem;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 1px solid var(--border);
      border-radius: 16px;
      margin-bottom: 2rem;
    }
    .header h1 {
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }
    .header .subtitle { color: var(--muted); font-size: 1rem; }
    .header .date { color: var(--muted); font-size: 0.85rem; margin-top: 0.75rem; }

    .meta-row {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1.25rem;
      flex-wrap: wrap;
    }
    .meta-chip {
      background: var(--surface2);
      padding: 0.35rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      color: var(--muted);
      border: 1px solid var(--border);
    }

    /* Sections */
    .section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 1.5rem;
    }
    .section h2 {
      font-size: 1.35rem;
      font-weight: 700;
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }
    .section h3 {
      font-size: 1.05rem;
      font-weight: 600;
      margin: 1.5rem 0 0.5rem;
      color: var(--text);
    }
    .section p, .section li {
      color: var(--muted);
      font-size: 0.92rem;
    }
    .section ul, .section ol { padding-left: 1.5rem; margin: 0.5rem 0; }
    .section li { margin-bottom: 0.3rem; }

    /* Badges */
    .badge {
      display: inline-block;
      padding: 0.15rem 0.6rem;
      border-radius: 6px;
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      vertical-align: middle;
    }
    .badge-critical { background: #7f1d1d; color: #fca5a5; }
    .badge-high { background: #78350f; color: #fcd34d; }
    .badge-done { background: #14532d; color: #86efac; }
    .badge-pending { background: #78350f; color: #fcd34d; }
    .badge-frontend { background: #312e81; color: #c4b5fd; }
    .badge-backend { background: #064e3b; color: #6ee7b7; }

    /* Status Banner */
    .status-banner {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }
    .status-banner.warning {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: var(--orange);
    }
    .status-banner .icon { font-size: 1.5rem; }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: 0.88rem;
    }
    th, td {
      padding: 0.7rem 0.9rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    th {
      background: var(--surface2);
      color: var(--text);
      font-weight: 600;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    td { color: var(--muted); }
    tr:hover td { background: rgba(59, 130, 246, 0.05); }

    /* Code blocks */
    code {
      background: var(--surface2);
      padding: 0.15rem 0.45rem;
      border-radius: 4px;
      font-family: 'Cascadia Code', 'Fira Code', monospace;
      font-size: 0.82rem;
      color: #e879f9;
    }
    pre {
      background: #0d1117;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem 1.25rem;
      overflow-x: auto;
      margin: 0.75rem 0;
      font-size: 0.82rem;
      line-height: 1.6;
    }
    pre code {
      background: none;
      padding: 0;
      color: #e2e8f0;
    }
    .code-comment { color: #6a9955; }
    .code-keyword { color: #c586c0; }
    .code-string { color: #ce9178; }
    .code-key { color: #9cdcfe; }

    /* Vulnerability Cards */
    .vuln-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.25rem;
      margin: 1rem 0;
      border-left: 4px solid var(--red);
    }
    .vuln-card.high { border-left-color: var(--orange); }
    .vuln-card.done { border-left-color: var(--green); }
    .vuln-card .vuln-title {
      font-weight: 700;
      font-size: 0.95rem;
      margin-bottom: 0.4rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .vuln-card .vuln-file {
      font-size: 0.8rem;
      color: var(--accent);
      margin-bottom: 0.5rem;
    }
    .vuln-card .vuln-desc { font-size: 0.88rem; color: var(--muted); }

    /* Fix Cards */
    .fix-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.25rem;
      margin: 1rem 0;
    }
    .fix-card.completed { border-left: 4px solid var(--green); }
    .fix-card.pending { border-left: 4px solid var(--orange); }
    .fix-card .fix-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .fix-card .fix-title { font-weight: 700; font-size: 0.95rem; }

    /* Flow Diagram */
    .flow {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin: 1.5rem 0;
      font-size: 0.85rem;
    }
    .flow-step {
      background: var(--surface2);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      text-align: center;
    }
    .flow-arrow { color: var(--muted); font-size: 1.2rem; }

    /* Checklist */
    .checklist { list-style: none; padding: 0; }
    .checklist li {
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(71, 85, 105, 0.3);
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
    }
    .check-icon { font-size: 1.1rem; flex-shrink: 0; }

    /* Phase Timeline */
    .timeline { position: relative; padding-left: 2rem; }
    .timeline::before {
      content: '';
      position: absolute;
      left: 0.5rem;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--border);
    }
    .timeline-item {
      position: relative;
      margin-bottom: 1.5rem;
      padding: 1rem 1.25rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -1.75rem;
      top: 1.25rem;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--accent);
      border: 2px solid var(--bg);
    }
    .timeline-item.done::before { background: var(--green); }
    .timeline-item.next::before { background: var(--orange); }
    .timeline-item .phase-label {
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.25rem;
    }
    .timeline-item.done .phase-label { color: var(--green); }
    .timeline-item.next .phase-label { color: var(--orange); }

    /* Print styles */
    @media print {
      body { background: #fff; color: #1a1a1a; padding: 1rem; }
      .header { background: #f8f9fa; border-color: #ddd; }
      .header h1 { -webkit-text-fill-color: #1a1a1a; background: none; }
      .section { border: 1px solid #ddd; background: #fff; }
      .vuln-card, .fix-card, .timeline-item { border: 1px solid #ddd; background: #f9f9f9; }
      th { background: #eee; color: #333; }
      td, p, li { color: #444; }
      .status-banner.warning { background: #fff3cd; border-color: #ffc107; color: #856404; }
      code { background: #f0f0f0; color: #c7254e; }
      pre { background: #f5f5f5; border-color: #ddd; }
      pre code { color: #333; }
    }

    @media (max-width: 640px) {
      body { padding: 1rem; }
      .section { padding: 1.25rem; }
      .header { padding: 2rem 1rem; }
      .header h1 { font-size: 1.5rem; }
      table { font-size: 0.8rem; }
      th, td { padding: 0.5rem; }
      .flow { font-size: 0.75rem; }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Header -->
    <div class="header">
      <h1>Fo-Fi IPTV FTA &mdash; Security Audit Report</h1>
      <div class="subtitle">HLS.js Streaming Security Assessment &amp; Hardening Roadmap</div>
      <div class="date">Generated: February 11, 2026</div>
      <div class="meta-row">
        <span class="meta-chip">React 18 + Vite</span>
        <span class="meta-chip">HLS.js Player</span>
        <span class="meta-chip">HTTP/2 Stream Proxy</span>
        <span class="meta-chip">PWA</span>
      </div>
    </div>

    <!-- Executive Summary -->
    <div class="status-banner warning">
      <span class="icon">&#9888;</span>
      <div>
        <strong>Current Risk Level: HIGH</strong>
        <div style="font-weight: 400; font-size: 0.85rem; color: var(--muted); margin-top: 0.2rem;">
          Stream URLs are exposed in the client. Phase 1 frontend hardening is complete.
          Backend fixes (Suresh) are required before public launch.
        </div>
      </div>
    </div>

    <!-- Section 1: How HLS.js Streaming Works -->
    <div class="section">
      <h2>1. How HLS.js Streaming Works in Fo-Fi</h2>
      <p>Understanding the data flow helps identify where attackers can intercept stream URLs:</p>

      <div class="flow">
        <div class="flow-step">User taps<br/>a channel</div>
        <span class="flow-arrow">&#8594;</span>
        <div class="flow-step">API call<br/><code>/ftauserstream</code></div>
        <span class="flow-arrow">&#8594;</span>
        <div class="flow-step">Server returns<br/><code>streamlink</code> URL</div>
        <span class="flow-arrow">&#8594;</span>
        <div class="flow-step">HLS.js loads<br/><code>.m3u8</code> manifest</div>
        <span class="flow-arrow">&#8594;</span>
        <div class="flow-step">HLS.js fetches<br/><code>.ts</code> segments</div>
        <span class="flow-arrow">&#8594;</span>
        <div class="flow-step">Video plays<br/>in browser</div>
      </div>

      <p style="margin-top: 1rem;"><strong>Key point:</strong> HLS.js itself is safe &mdash; it&rsquo;s used by Twitter/X, CNN, and thousands of production apps. The vulnerability is in <em>how our app exposes and handles</em> the stream URLs, not in the player library.</p>
    </div>

    <!-- Section 2: Vulnerabilities Found -->
    <div class="section">
      <h2>2. Vulnerabilities Found</h2>

      <div class="vuln-card">
        <div class="vuln-title">
          <span class="badge badge-critical">CRITICAL</span>
          #1 &mdash; Stream URL Printed in Console Logs
        </div>
        <div class="vuln-file">File: <code>src/pages/PlayerPage.jsx:211-218</code></div>
        <div class="vuln-desc">
          Console logs print the raw stream URL and the proxied URL.
          <strong>Attack:</strong> Open DevTools &rarr; Console &rarr; copy URL &rarr; paste in VLC &rarr; stream stolen.
        </div>
      </div>

      <div class="vuln-card">
        <div class="vuln-title">
          <span class="badge badge-critical">CRITICAL</span>
          #2 &mdash; Stream URL Visible in Network Tab
        </div>
        <div class="vuln-file">File: <code>src/pages/PlayerPage.jsx</code> (HLS.js xhrSetup)</div>
        <div class="vuln-desc">
          Every <code>.m3u8</code> manifest and <code>.ts</code> segment request appears in DevTools Network tab.
          The request path combined with the known domain lets an attacker reconstruct the full URL.
        </div>
      </div>

      <div class="vuln-card">
        <div class="vuln-title">
          <span class="badge badge-critical">CRITICAL</span>
          #3 &mdash; Stream Proxy Had Zero Authentication
        </div>
        <div class="vuln-file">File: <code>stream-proxy-plugin.js:131</code></div>
        <div class="vuln-desc">
          Anyone who hit <code>/stream/&lt;path&gt;</code> got the content with no token, no cookie, no check.
          CORS was <code>Access-Control-Allow-Origin: *</code> &mdash; any website could embed your streams.
        </div>
      </div>

      <div class="vuln-card">
        <div class="vuln-title">
          <span class="badge badge-critical">CRITICAL</span>
          #4 &mdash; Stream Server Has No Access Control
        </div>
        <div class="vuln-file">Server: stream server endpoint</div>
        <div class="vuln-desc">
          The HLS server accepts requests from anyone worldwide. No token validation, no IP whitelisting, no geo-restriction. Once a URL is known, it&rsquo;s permanently accessible.
        </div>
      </div>

      <div class="vuln-card high">
        <div class="vuln-title">
          <span class="badge badge-high">HIGH</span>
          #5 &mdash; No DRM / No Segment Encryption
        </div>
        <div class="vuln-desc">
          HLS segments (<code>.ts</code> files) are plain unencrypted MPEG-TS. No AES-128 encryption, no Widevine/FairPlay/PlayReady DRM. Anyone can download and redistribute video segments.
        </div>
      </div>

      <div class="vuln-card high">
        <div class="vuln-title">
          <span class="badge badge-high">HIGH</span>
          #6 &mdash; API Exposes Stream URL Without Session Validation
        </div>
        <div class="vuln-file">File: <code>src/services/api.js:142-150</code> &rarr; <code>/ftauserstream</code></div>
        <div class="vuln-desc">
          The API returns the <code>streamlink</code> in the response body. It only requires a mobile number (no session token). An attacker can call the API directly.
        </div>
      </div>

      <div class="vuln-card high">
        <div class="vuln-title">
          <span class="badge badge-high">HIGH</span>
          #7 &mdash; API Credentials Baked into Client JavaScript
        </div>
        <div class="vuln-file">Files: <code>.env.production</code>, <code>src/services/api.js:6</code></div>
        <div class="vuln-desc">
          <code>VITE_API_USERNAME</code>, <code>VITE_API_PASSWORD</code>, and <code>VITE_API_AUTH_KEY</code> are embedded in the production bundle. Anyone can extract them from DevTools &rarr; Sources.
        </div>
      </div>

      <div class="vuln-card high">
        <div class="vuln-title">
          <span class="badge badge-high">HIGH</span>
          #8 &mdash; Mock OTP Verification (No Real Auth)
        </div>
        <div class="vuln-file">File: <code>src/pages/VerifyOtp.jsx:45-62</code></div>
        <div class="vuln-desc">
          OTP verification is mocked &mdash; any 4-digit code is accepted. The real <code>verifyOtp()</code> API call is never executed. Zero authentication.
        </div>
      </div>
    </div>

    <!-- Section 3: Frontend Fixes (COMPLETED) -->
    <div class="section">
      <h2>3. Frontend Fixes &mdash; COMPLETED <span class="badge badge-done">DONE</span></h2>
      <p>These fixes have been implemented and are ready for deployment:</p>

      <div class="fix-card completed">
        <div class="fix-header">
          <span class="fix-title">&#10003; Fix 1: Strip Console Logs in Production Build</span>
          <span class="badge badge-done">DONE</span>
        </div>
        <div class="vuln-file">File: <code>vite.config.js:107-112</code></div>
        <div class="vuln-desc">
          Added <code>esbuild.drop: ["console", "debugger"]</code> for production builds.
          All <code>console.log</code>, <code>console.group</code>, <code>console.error</code> calls are <strong>completely removed</strong> from the production JavaScript bundle. Zero performance cost.
        </div>
        <pre><code><span class="code-key">build</span>: {
  <span class="code-key">minify</span>: <span class="code-string">"esbuild"</span>,
},
<span class="code-key">esbuild</span>: {
  <span class="code-key">drop</span>: process.env.NODE_ENV === <span class="code-string">"production"</span>
    ? [<span class="code-string">"console"</span>, <span class="code-string">"debugger"</span>]
    : [],
},</code></pre>
        <p><strong>Result:</strong> Stream URLs, API responses, and mobile numbers no longer appear in DevTools console in production.</p>
      </div>

      <div class="fix-card completed">
        <div class="fix-header">
          <span class="fix-title">&#10003; Fix 2: Removed Hardcoded Stream Host from Client Code</span>
          <span class="badge badge-done">DONE</span>
        </div>
        <div class="vuln-file">Files: <code>stream-proxy-plugin.js:9</code>, <code>PlayerPage.jsx:28-33</code>, <code>.env.*</code></div>
        <div class="vuln-desc">
          <ul>
            <li><code>stream-proxy-plugin.js</code> now reads <code>STREAM_HOST</code> from environment variable (server-side only, never in client bundle)</li>
            <li><code>PlayerPage.jsx</code> <code>proxyStreamUrl()</code> now uses a generic regex &mdash; the actual hostname never appears in client JavaScript</li>
            <li><code>STREAM_HOST</code> added to <code>.env</code> files <strong>without</strong> <code>VITE_</code> prefix so Vite does NOT bundle it into the client</li>
          </ul>
        </div>
        <pre><code><span class="code-comment">// stream-proxy-plugin.js (server-side only)</span>
<span class="code-keyword">const</span> STREAM_HOST = process.env.STREAM_HOST || <span class="code-string">"fallback"</span>;

<span class="code-comment">// PlayerPage.jsx (client-side &mdash; no hostname visible)</span>
<span class="code-keyword">const</span> STREAM_RE = <span class="code-string">/^https?:\/\/[^/]+\.bbnl\.in/i</span>;
<span class="code-keyword">function</span> proxyStreamUrl(url) {
  <span class="code-keyword">return</span> url.replace(STREAM_RE, <span class="code-string">"/stream"</span>);
}</code></pre>
        <p><strong>Result:</strong> Attacker cannot find the actual stream server hostname in the production bundle source code.</p>
      </div>

      <div class="fix-card completed">
        <div class="fix-header">
          <span class="fix-title">&#10003; Fix 3: Restricted CORS + Origin/Referer Gate on Stream Proxy</span>
          <span class="badge badge-done">DONE</span>
        </div>
        <div class="vuln-file">File: <code>stream-proxy-plugin.js:133-163</code></div>
        <div class="vuln-desc">
          <ul>
            <li>Added <strong>Origin/Referer validation</strong> &mdash; only requests from the app&rsquo;s own host are allowed</li>
            <li>Foreign origins receive <strong>HTTP 403 Forbidden</strong> immediately</li>
            <li>CORS header changed from <code>*</code> to the <strong>actual requesting origin</strong> (reflected, not wildcard)</li>
          </ul>
        </div>
        <pre><code><span class="code-comment">// Only allow requests from our own app (same origin)</span>
<span class="code-keyword">const</span> allowed =
  origin === <span class="code-string">`http://${host}`</span> ||
  origin === <span class="code-string">`https://${host}`</span> ||
  referer.startsWith(<span class="code-string">`http://${host}`</span>) ||
  referer.startsWith(<span class="code-string">`https://${host}`</span>) ||
  (!origin &amp;&amp; !referer); <span class="code-comment">// HLS.js segment fetches may omit Origin</span>

<span class="code-keyword">if</span> (!allowed) {
  res.writeHead(<span class="code-string">403</span>);
  res.end(<span class="code-string">"Forbidden"</span>);
}</code></pre>
        <p><strong>Result:</strong> Other websites cannot embed or proxy your streams. Direct browser access from foreign origins is blocked.</p>
      </div>
    </div>

    <!-- Section 4: Backend Fixes Required (Suresh) -->
    <div class="section">
      <h2>4. Backend Fixes Required <span class="badge badge-pending">PENDING &mdash; Suresh</span></h2>
      <p>These changes <strong>must</strong> be implemented on the server side before public launch. The frontend fixes above reduce the attack surface but <strong>cannot fully protect</strong> streams without server cooperation.</p>

      <div class="fix-card pending">
        <div class="fix-header">
          <span class="fix-title">Backend Fix 1: Expiring Stream Tokens (MOST IMPORTANT)</span>
          <span class="badge badge-backend">BACKEND</span>
        </div>
        <div class="vuln-desc">
          <h3>How it should work:</h3>
          <ol>
            <li>When <code>/ftauserstream</code> is called, backend generates a <strong>signed token</strong> (JWT or HMAC)
              <ul>
                <li>Contains: <code>user_id</code>, <code>channel_id</code>, <code>expires_at</code> (15 min), <code>ip_address</code></li>
              </ul>
            </li>
            <li>Returns: <code>{ streamlink: "...", stream_token: "abc123..." }</code></li>
            <li>Stream server validates the token on every <code>.m3u8</code> / <code>.ts</code> request</li>
            <li>Expired or invalid token &rarr; <strong>HTTP 403</strong></li>
          </ol>
          <h3>Why this is essential:</h3>
          <p>Even if someone copies the URL from the Network tab, it <strong>stops working after 15 minutes</strong>. This is how Netflix, Hotstar, and every major streaming platform works.</p>
          <h3>Frontend integration (we will do this once backend is ready):</h3>
          <ul>
            <li>HLS.js <code>xhrSetup</code> will attach the token to every segment request as a query param or header</li>
            <li>Stream proxy will validate the token before forwarding to the stream server</li>
          </ul>
        </div>
      </div>

      <div class="fix-card pending">
        <div class="fix-header">
          <span class="fix-title">Backend Fix 2: JWT Session Tokens (Replace Mobile-Number Auth)</span>
          <span class="badge badge-backend">BACKEND</span>
        </div>
        <div class="vuln-desc">
          <h3>Current problem:</h3>
          <p>Every API call sends the user&rsquo;s mobile number as the identifier. There&rsquo;s no session token, no expiry, and no way to revoke access. The <code>VITE_API_USERNAME</code>/<code>VITE_API_PASSWORD</code> are shared credentials baked into the client.</p>
          <h3>Required changes:</h3>
          <ol>
            <li>After OTP verification, return a <strong>JWT token</strong> (not just &ldquo;success&rdquo;)</li>
            <li>Frontend stores JWT and sends it with every API call instead of Basic Auth</li>
            <li>Add a <code>/refreshtoken</code> endpoint to extend sessions</li>
            <li>Move Basic Auth to server-to-server communication only</li>
            <li>No JWT = no API access, no stream URLs</li>
          </ol>
        </div>
      </div>

      <div class="fix-card pending">
        <div class="fix-header">
          <span class="fix-title">Backend Fix 3: Real OTP Verification</span>
          <span class="badge badge-backend">BACKEND</span>
        </div>
        <div class="vuln-desc">
          <p>The <code>/verifyftauserotp</code> endpoint must properly validate the OTP code. Currently the frontend mocks this &mdash; any 4-digit number is accepted. The backend must:</p>
          <ul>
            <li>Validate OTP against what was sent via SMS</li>
            <li>Expire OTPs after 5 minutes</li>
            <li>Rate-limit: max 3 OTP requests per 10 minutes per number</li>
            <li>Return a JWT on successful verification</li>
          </ul>
        </div>
      </div>

      <div class="fix-card pending">
        <div class="fix-header">
          <span class="fix-title">Backend Fix 4: HLS AES-128 Segment Encryption</span>
          <span class="badge badge-backend">BACKEND</span>
        </div>
        <div class="vuln-desc">
          <h3>How it works:</h3>
          <ol>
            <li>Stream server encrypts each <code>.ts</code> segment with <strong>AES-128</strong></li>
            <li>The <code>.m3u8</code> manifest includes an <code>#EXT-X-KEY</code> tag pointing to a key URL</li>
            <li>Key URL requires a valid stream token to return the decryption key</li>
            <li>HLS.js <strong>automatically handles</strong> <code>#EXT-X-KEY</code> &mdash; fetches the key and decrypts in-browser</li>
          </ol>
          <p><strong>Why:</strong> Even if someone downloads the <code>.ts</code> files, they&rsquo;re encrypted and useless without the key. The key is only served to authenticated sessions.</p>
        </div>
      </div>

      <div class="fix-card pending">
        <div class="fix-header">
          <span class="fix-title">Backend Fix 5: IP Whitelisting + Geo Restriction on Stream Server</span>
          <span class="badge badge-backend">BACKEND</span>
        </div>
        <div class="vuln-desc">
          <ul>
            <li><strong>IP whitelist:</strong> Only allow the proxy/app server&rsquo;s IP to access the stream server directly &mdash; block all other IPs</li>
            <li><strong>Geo-blocking:</strong> If streams are licensed per-country, restrict by country</li>
            <li><strong>Rate-limit:</strong> Max 2-3 concurrent streams per user/IP</li>
          </ul>
        </div>
      </div>

      <div class="fix-card pending">
        <div class="fix-header">
          <span class="fix-title">Backend Fix 6: Return Relative URLs (Hide Infrastructure)</span>
          <span class="badge badge-backend">BACKEND</span>
        </div>
        <div class="vuln-desc">
          <p>Currently the API returns absolute URLs containing internal server IPs and domains. The backend should:</p>
          <ul>
            <li>Return <strong>relative paths</strong> for channel logos and stream URLs</li>
            <li>Never expose internal server IPs or infrastructure domains in API responses</li>
            <li>Let the frontend/proxy resolve the actual server address</li>
          </ul>
        </div>
      </div>

      <div class="fix-card pending">
        <div class="fix-header">
          <span class="fix-title">Backend Fix 7: Full DRM (For Premium/Licensed Content)</span>
          <span class="badge badge-backend">BACKEND</span>
        </div>
        <div class="vuln-desc">
          <p>Only needed if content has licensing requirements or will be paid:</p>
          <table>
            <tr>
              <th>DRM System</th>
              <th>Browsers/Platforms</th>
              <th>Cost</th>
            </tr>
            <tr>
              <td><strong>Widevine</strong></td>
              <td>Chrome, Android, Firefox, Edge</td>
              <td>Free (requires license server)</td>
            </tr>
            <tr>
              <td><strong>FairPlay</strong></td>
              <td>Safari, iOS</td>
              <td>Apple Developer Account required</td>
            </tr>
            <tr>
              <td><strong>PlayReady</strong></td>
              <td>Edge, Windows, Xbox</td>
              <td>Microsoft ecosystem</td>
            </tr>
          </table>
          <p style="margin-top: 0.5rem;">DRM prevents screen recording and makes redistribution nearly impossible. HLS.js supports Widevine/PlayReady via EME (Encrypted Media Extensions).</p>
        </div>
      </div>
    </div>

    <!-- Section 5: Implementation Timeline -->
    <div class="section">
      <h2>5. Implementation Timeline</h2>

      <div class="timeline">
        <div class="timeline-item done">
          <div class="phase-label">Phase 1 &mdash; Completed (Frontend)</div>
          <table>
            <tr><th>Task</th><th>Status</th><th>Owner</th></tr>
            <tr><td>Strip console logs from production build</td><td><span class="badge badge-done">DONE</span></td><td><span class="badge badge-frontend">Frontend</span></td></tr>
            <tr><td>Remove hardcoded stream host from client code</td><td><span class="badge badge-done">DONE</span></td><td><span class="badge badge-frontend">Frontend</span></td></tr>
            <tr><td>Restrict CORS + add Origin/Referer gate</td><td><span class="badge badge-done">DONE</span></td><td><span class="badge badge-frontend">Frontend</span></td></tr>
          </table>
        </div>

        <div class="timeline-item next">
          <div class="phase-label">Phase 2 &mdash; Before Public Launch (Backend Required)</div>
          <table>
            <tr><th>Task</th><th>Effort</th><th>Owner</th></tr>
            <tr><td>Implement real OTP verification</td><td>1-2 days</td><td><span class="badge badge-backend">Backend</span></td></tr>
            <tr><td>JWT session tokens (replace Basic Auth)</td><td>2-3 days</td><td><span class="badge badge-backend">Backend</span></td></tr>
            <tr><td>Expiring stream tokens (15-min JWT)</td><td>2-3 days</td><td><span class="badge badge-backend">Backend</span></td></tr>
            <tr><td>Token validation in stream proxy</td><td>1 day</td><td><span class="badge badge-frontend">Frontend</span> + <span class="badge badge-backend">Backend</span></td></tr>
          </table>
        </div>

        <div class="timeline-item">
          <div class="phase-label" style="color: var(--accent);">Phase 3 &mdash; Hardening</div>
          <table>
            <tr><th>Task</th><th>Effort</th><th>Owner</th></tr>
            <tr><td>HLS AES-128 segment encryption</td><td>3-5 days</td><td><span class="badge badge-backend">Backend</span></td></tr>
            <tr><td>IP whitelisting on stream server</td><td>1 day</td><td><span class="badge badge-backend">Backend</span></td></tr>
            <tr><td>Return relative URLs (hide infrastructure)</td><td>1 day</td><td><span class="badge badge-backend">Backend</span></td></tr>
          </table>
        </div>

        <div class="timeline-item">
          <div class="phase-label" style="color: var(--purple);">Phase 4 &mdash; Premium (If Needed)</div>
          <table>
            <tr><th>Task</th><th>Effort</th><th>Owner</th></tr>
            <tr><td>Full DRM (Widevine + FairPlay)</td><td>1-2 weeks</td><td><span class="badge badge-backend">Backend</span></td></tr>
            <tr><td>Geo-restriction per country</td><td>1-2 days</td><td><span class="badge badge-backend">Backend</span></td></tr>
            <tr><td>Concurrent stream limit per user</td><td>1 day</td><td><span class="badge badge-backend">Backend</span></td></tr>
          </table>
        </div>
      </div>
    </div>

    <!-- Section 6: Security Comparison -->
    <div class="section">
      <h2>6. Security Comparison &mdash; Before vs After</h2>
      <table>
        <tr>
          <th>Attack Vector</th>
          <th>Before</th>
          <th>After Phase 1</th>
          <th>After Phase 2+</th>
        </tr>
        <tr>
          <td>Extract stream URL from console</td>
          <td style="color: var(--red);">&#10006; Trivial</td>
          <td style="color: var(--green);">&#10003; Blocked</td>
          <td style="color: var(--green);">&#10003; Blocked</td>
        </tr>
        <tr>
          <td>Find stream host in source code</td>
          <td style="color: var(--red);">&#10006; Hardcoded</td>
          <td style="color: var(--green);">&#10003; Removed</td>
          <td style="color: var(--green);">&#10003; Removed</td>
        </tr>
        <tr>
          <td>Embed streams from another website</td>
          <td style="color: var(--red);">&#10006; CORS *</td>
          <td style="color: var(--green);">&#10003; Origin gate</td>
          <td style="color: var(--green);">&#10003; Origin + token</td>
        </tr>
        <tr>
          <td>Copy URL from Network tab &amp; reshare</td>
          <td style="color: var(--red);">&#10006; Works forever</td>
          <td style="color: var(--orange);">&#9888; Still possible</td>
          <td style="color: var(--green);">&#10003; Expires in 15 min</td>
        </tr>
        <tr>
          <td>Access stream server directly</td>
          <td style="color: var(--red);">&#10006; Open to world</td>
          <td style="color: var(--orange);">&#9888; Still open</td>
          <td style="color: var(--green);">&#10003; IP whitelisted</td>
        </tr>
        <tr>
          <td>Download &amp; save video segments</td>
          <td style="color: var(--red);">&#10006; Plain MPEG-TS</td>
          <td style="color: var(--orange);">&#9888; Still plain</td>
          <td style="color: var(--green);">&#10003; AES-128 encrypted</td>
        </tr>
        <tr>
          <td>Impersonate app (steal API keys)</td>
          <td style="color: var(--red);">&#10006; Keys in bundle</td>
          <td style="color: var(--orange);">&#9888; Still in bundle</td>
          <td style="color: var(--green);">&#10003; JWT per-user auth</td>
        </tr>
        <tr>
          <td>Register as any phone number</td>
          <td style="color: var(--red);">&#10006; Mock OTP</td>
          <td style="color: var(--orange);">&#9888; Still mock</td>
          <td style="color: var(--green);">&#10003; Real OTP verified</td>
        </tr>
      </table>
    </div>

    <!-- Section 7: Verification Checklist -->
    <div class="section">
      <h2>7. Verification Checklist</h2>
      <p>Use this checklist to verify security after each phase:</p>

      <h3>Phase 1 Verification (Can Do Now)</h3>
      <ul class="checklist">
        <li><span class="check-icon" style="color: var(--green);">&#10003;</span> <code>npm run build</code> &rarr; inspect <code>dist/assets/*.js</code> &rarr; search for stream hostname &rarr; should find <strong>NONE</strong></li>
        <li><span class="check-icon" style="color: var(--green);">&#10003;</span> <code>npm run build</code> &rarr; inspect <code>dist/assets/*.js</code> &rarr; search for <code>console.log</code> &rarr; should find <strong>NONE</strong></li>
        <li><span class="check-icon" style="color: var(--green);">&#10003;</span> Open production app &rarr; DevTools &rarr; Console &rarr; no stream URLs printed</li>
        <li><span class="check-icon" style="color: var(--green);">&#10003;</span> Try fetching <code>/stream/...</code> from a different origin &rarr; should return <strong>403 Forbidden</strong></li>
      </ul>

      <h3>Phase 2 Verification (After Backend Work)</h3>
      <ul class="checklist">
        <li><span class="check-icon" style="color: var(--orange);">&#9675;</span> Enter wrong OTP &rarr; should be <strong>rejected</strong></li>
        <li><span class="check-icon" style="color: var(--orange);">&#9675;</span> Open DevTools &rarr; Sources &rarr; search for passwords/auth keys &rarr; should find <strong>NONE</strong></li>
        <li><span class="check-icon" style="color: var(--orange);">&#9675;</span> Copy a stream URL &rarr; wait 15 min &rarr; try again &rarr; should return <strong>403</strong></li>
        <li><span class="check-icon" style="color: var(--orange);">&#9675;</span> Call <code>/ftauserstream</code> without JWT &rarr; should return <strong>401</strong></li>
      </ul>

      <h3>Phase 3 Verification (After Hardening)</h3>
      <ul class="checklist">
        <li><span class="check-icon" style="color: var(--muted);">&#9675;</span> Download a <code>.ts</code> segment directly &rarr; should be <strong>encrypted/unplayable</strong></li>
        <li><span class="check-icon" style="color: var(--muted);">&#9675;</span> Access stream server directly from outside &rarr; should be <strong>blocked by IP whitelist</strong></li>
        <li><span class="check-icon" style="color: var(--muted);">&#9675;</span> API responses should <strong>not</strong> contain internal IPs or infrastructure hostnames</li>
      </ul>
    </div>

    <!-- Footer -->
    <div style="text-align: center; padding: 2rem; color: var(--muted); font-size: 0.8rem; border-top: 1px solid var(--border); margin-top: 1rem;">
      <p><strong>Fo-Fi IPTV FTA &mdash; Security Audit Report</strong></p>
      <p style="margin-top: 0.25rem;">Prepared for Rishi (Client) &amp; Suresh (Backend) | February 2026</p>
      <p style="margin-top: 0.5rem; color: var(--red);">Confidential &mdash; Do not distribute outside the team</p>
    </div>

  </div>
</body>
</html>